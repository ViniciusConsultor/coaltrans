<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>舆情监控系统</title>
<link href="css/common.css" type="text/css" rel="stylesheet" rev="stylesheet" media="all" />
<link href="css/style.css" type="text/css" rel="stylesheet" rev="stylesheet" media="all" />
<script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript">
        function initDate() {
            var taday = new Date();
            var month = taday.getMonth() + 1;
            var taday_show = taday.getFullYear() + "年" + month + "月" + taday.getDate() + "日";
            $("#today").html(taday_show);
        }

        $(document).ready(function() {

            initDate();

            $("#keyword").focus(function() {
                $(this).val("");
            });

            $("#keyword").blur(function() {
                $("#keyword").unbind("focus");
            });

            $("#btnSearch").click(function() {
                var keyword = $("#keywords").val();
                $.get("Handler/Handler.ashx", { 'keyword': keyword },
                    function(data) {
                        $("#result").html(data);
                        $("#result").show(800);
                    }
                );
            });

            //加载初始数据
            $.get("Handler/Handler.ashx", { 'category': 'feiwen' },
                    function(data) {
                        var query_content = $("#query_content");
                        query_content.html(data);
                        query_content.show(300);
                    });

            $(".tab_click").each(function() {
                $(this).click(function() {
                    //删除所有tab的样式
                    $("#sortTab").children("li").each(function() {
                        $(this).removeClass();
                    });
                    //给选中的tab设置样式
                    $(this).parent().removeClass("normal").addClass("active");
                    //内容填充
                    var category = $(this).attr("id");
                    $.get("Handler/Handler.ashx", { 'category': category },
                    function(data) {
                        var query_content = $("#query_content");
                        query_content.hide(300);
                        query_content.html(data);
                        query_content.show(300);
                    });
                });
            });

            $.ajax({
                type: "get",
                url: "Handler/GetMapData.ashx",
                beforeSend: function(XMLHttpRequest) {
                    $("#hot_image").html("热点数据加载中……");
                },
                success: function(data, textStatus) {
                    var map = $("#map");
                    map.after(data);
                    //隐藏文字说明
                    $(".node_text").each(function() {
                        $(this).hide();
                    });

                    $(".node").each(function() {
                        $(this).mouseover(function() {
                            var num = $(this).attr("id").split("_")[1];
                            $("#clustertitle_" + num).show();
                        });

                        $(this).mouseout(function() {
                            var num = $(this).attr("id").split("_")[1];
                            $("#clustertitle_" + num).hide();
                        });

                        $(this).click(function() {
                            var cluster_id = $(this).attr("id").split("_")[1];
                            $.get("Handler/GetClusterResults.ashx", { 'cluster_id': cluster_id },
                                    function(data) {
                                        $("#whats_hot").empty().html(data);
                                        $("#whats_hot").show(200);
                                    }
                                );
                        });
                    }); //each end
                },
                complete: function(XMLHttpRequest, textStatus) {
                    $("#hot_image").html("舆情热点图<br/>(点击红色方块，可在右侧区域获取文章列表)");
                },
                error: function() {
                    //请求出错处理
                }
            });

        });
        
//            加载热点图数据，这里要做一个异步处理
//            $.get("Handler/GetMapData.ashx", { 'db': 'demo1' },
//                    function(data) {
//                     alert(data); });
                     
    </script>
</head>

<body>
<div id="wrapper">
	<!-- 头部开始 -->
	<div id="header" class="clearfix">
		<div class="topInfo">您好，<strong>张艺谋</strong> 今天是<em id="today"></em>，欢迎进入国科安信舆情监控系统 <a href="#">退出</a></div>
		<h1><a href="#"><img src="images/logo.jpg" alt="舆情监控系统" /></a></h1>
		<div class="search">
			<fieldset>
			<form action="search.html" method="get">
				<input id="keyword" name="keyword" type="text" class="input_text" value="请输入查询内容" />
				<input name="search" type="submit" value="搜索" class="input_button" />
			</form>
			</fieldset>
		</div>
		<p class="notice">过去 <strong>一周</strong> 约有 <strong>2378</strong> 篇与您相关的舆情，涉及 <strong>23</strong> 个事件，其中 <strong>2</strong> 个新事件。</p>
		<div class="nav clearfix">
			<ul class="mainNav">
				<li class="current"><a href="#">全部</a></li>
				<li><a href="news.html">新闻</a></li>
				<li><a href="#">博客</a></li>
				<li><a href="#">论坛</a></li>
			</ul>
			<ul class="periodNav">
				<li><a href="#">过去一天</a></li>
				<li class="current"><a href="#">过去一周</a></li>
				<li><a href="#">过去一月</a></li>
			</ul>
		</div>
	</div>
	<!-- 头部结束 -->
	<!-- 内容开始 -->
	<div id="content" class="clearfix">
		<div class="main">
			<ul id="sortTab" class="newsSort">
				<li class="active"><a class="tab_click" id="feiwen" href="javascript:void(null)">绯闻</a></li>
				<li class="normal"><a class="tab_click" id="sanqiang" href="javascript:void(null)">《三枪》</a></li>
			</ul>
			<div id="sortTab_Content" class="newsSort_body clearfix">
				<div id="query_content" class="newsSort_list">
				</div>
				<div id="map" class="topNews">
					<img src="http://121.101.220.143:9000/action=clusterserve2dmap&sourcejobname=myjob_clusters" alt="" />
					<h3><a id="hot_image" href="#"></a></h3>
				</div>
			</div>
		</div>
		<div class="side">
			<div class="hotNews">
				<h2>热点文章列表
					<span title="展开合起" class="bodyUp">展开合起</span>
					<!-- span为控制展开合起标签，展开时样式为bodyUp，合起时为bodyDown -->
				</h2>
				<ul id="whats_hot">
				</ul>
			</div>
		</div>
	</div>
	<!-- 内容结束 -->
	<!-- 版权开始 -->
	<p id="footer">Copyright &copy; 2009-2014 Beijing People Co.,LTD 业务联系：Tel(86)10-58289500 京ICP证090267号</p>
	<!-- 版权结束 -->
</div>
</body>
</html>
